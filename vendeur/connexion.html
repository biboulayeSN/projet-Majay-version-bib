<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion - MAJAY</title>
    <link rel="stylesheet" href="../css/design-system.css">
    <link rel="stylesheet" href="../css/dashboard.css">
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-header">
            <h1 class="logo">üõçÔ∏è MAJAY</h1>
            <p class="tagline">Connectez-vous</p>
        </div>

        <div class="auth-card">
            <h2>Connexion Vendeur</h2>
            <p class="auth-subtitle">G√©rez votre boutique</p>

            <!-- √âtape 1 : Entrer le t√©l√©phone -->
            <form id="connexionForm" class="auth-form" style="display: block;">
                <div class="form-group">
                    <label>Num√©ro de t√©l√©phone</label>
                    <input type="tel" id="telephone" required placeholder="+221 77 123 45 67">
                    <span class="form-hint">Format : +221 77 123 45 67</span>
                </div>

                <button type="submit" class="btn btn-primary btn-lg" id="btnSubmit" style="width: 100%; padding: 18px 30px; font-size: 1.1em; min-height: 60px; font-weight: 700;">
                    <span class="btn-text">üì± Envoyer le code</span>
                    <span class="btn-loader" style="display:none">‚è≥</span>
                </button>
            </form>

            <!-- √âtape 2 : Entrer le code OTP -->
            <form id="otpForm" class="auth-form" style="display: none;">
                <div class="form-group">
                    <label>Code de v√©rification</label>
                    <input type="text" id="otpCode" required placeholder="123456" maxlength="6" pattern="[0-9]{6}">
                    <span class="form-hint">Entrez le code re√ßu par SMS</span>
                </div>

                <button type="submit" class="btn btn-primary btn-lg" id="btnVerify" style="width: 100%; padding: 18px 30px; font-size: 1.1em; min-height: 60px; font-weight: 700;">
                    <span class="btn-text">‚úÖ V√©rifier</span>
                    <span class="btn-loader" style="display:none">‚è≥</span>
                </button>

                <button type="button" class="btn btn-secondary" onclick="retourTelephone()" style="margin-top: 15px; width: 100%; padding: 14px 24px; min-height: 48px;">
                    ‚Üê Retour
                </button>
            </form>

            <div class="auth-footer">
                <p>Pas de boutique ? <a href="inscription.html">Cr√©er maintenant</a></p>
            </div>
        </div>
    </div>

    <script type="module">
import { authMajay } from "../js/auth.js";

let phoneNumber = '';

document.getElementById("connexionForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const btn = document.getElementById("btnSubmit");
  btn.disabled = true;
  btn.querySelector('.btn-text').style.display = 'none';
  btn.querySelector('.btn-loader').style.display = 'inline';

  phoneNumber = document.getElementById("telephone").value.trim();

  const result = await authMajay.connexionVendeur(phoneNumber);

  btn.disabled = false;
  btn.querySelector('.btn-text').style.display = 'inline';
  btn.querySelector('.btn-loader').style.display = 'none';

  if (!result.success) {
    const { showError } = await import("../js/notifications.js");
    showError(result.error);
    return;
  }
  
  const { showSuccess } = await import("../js/notifications.js");
  showSuccess("Code envoy√© ! V√©rifiez votre t√©l√©phone.");

  // Afficher le formulaire OTP
  document.getElementById("connexionForm").style.display = 'none';
  document.getElementById("otpForm").style.display = 'block';
  document.getElementById("otpCode").focus();
});

document.getElementById("otpForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const btn = document.getElementById("btnVerify");
  btn.disabled = true;
  btn.querySelector('.btn-text').style.display = 'none';
  btn.querySelector('.btn-loader').style.display = 'inline';

  const code = document.getElementById("otpCode").value.trim();

  const result = await authMajay.verifierConnexion(code);

  btn.disabled = false;
  btn.querySelector('.btn-text').style.display = 'inline';
  btn.querySelector('.btn-loader').style.display = 'none';

  if (!result.success) {
    const { showError } = await import("../js/notifications.js");
    showError(result.error);
    return;
  }

  const { showSuccess } = await import("../js/notifications.js");
  showSuccess("Connexion r√©ussie ! Redirection...");
  setTimeout(() => {
    window.location.href = "dashboard.html";
  }, 1000);
});

window.retourTelephone = function() {
  document.getElementById("connexionForm").style.display = 'block';
  document.getElementById("otpForm").style.display = 'none';
  document.getElementById("otpCode").value = '';
};
</script>


</body>
</html>


